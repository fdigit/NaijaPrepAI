{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Documents/fDigit%20Technologies/NaijaPrepAI/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["// üí• CRITICAL FIX: Forces Next.js to use the Node.js environment\n// This must be the FIRST line (before any imports) to resolve Prisma initialization errors\nexport const runtime = 'nodejs';\n\nimport type { NextRequest } from 'next/server';\n\n// Dynamic imports to avoid module-level evaluation\n// Import NextAuth and providers only when needed\nlet NextAuthModule: any = null;\nlet CredentialsProviderModule: any = null;\nlet GoogleProviderModule: any = null;\nlet PrismaAdapterModule: any = null;\nlet PrismaModule: any = null;\nlet bcryptModule: any = null;\n\nasync function getNextAuthModule() {\n  if (!NextAuthModule) {\n    NextAuthModule = await import('next-auth');\n  }\n  return NextAuthModule.default;\n}\n\nasync function getCredentialsProvider() {\n  if (!CredentialsProviderModule) {\n    CredentialsProviderModule = await import('next-auth/providers/credentials');\n  }\n  return CredentialsProviderModule.default;\n}\n\nasync function getGoogleProvider() {\n  if (!GoogleProviderModule) {\n    GoogleProviderModule = await import('next-auth/providers/google');\n  }\n  return GoogleProviderModule.default;\n}\n\nasync function getPrisma() {\n  if (!PrismaModule) {\n    PrismaModule = await import('@/lib/prisma');\n  }\n  return PrismaModule.prisma;\n}\n\nasync function getPrismaAdapter() {\n  if (!PrismaAdapterModule) {\n    PrismaAdapterModule = await import('@auth/prisma-adapter');\n  }\n  const prisma = await getPrisma();\n  return PrismaAdapterModule.PrismaAdapter(prisma);\n}\n\nasync function getBcrypt() {\n  if (!bcryptModule) {\n    bcryptModule = await import('bcryptjs');\n  }\n  return bcryptModule.default;\n}\n\n// Validate required environment variables\nfunction validateEnvVars() {\n  const required = ['NEXTAUTH_SECRET', 'DATABASE_URL'];\n  const missing = required.filter(key => !process.env[key]);\n  \n  if (missing.length > 0) {\n    throw new Error(\n      `Missing required environment variables: ${missing.join(', ')}\\n` +\n      `Please create a .env.local file with these variables. See ENV_SETUP_GUIDE.md for details.`\n    );\n  }\n  \n  if (!process.env.NEXTAUTH_SECRET || process.env.NEXTAUTH_SECRET.length < 32) {\n    console.warn(\n      '‚ö†Ô∏è  WARNING: NEXTAUTH_SECRET should be at least 32 characters long for security.'\n    );\n  }\n}\n\n// Make authOptions a getter function to avoid module-level evaluation\nasync function getAuthOptions(): Promise<any> {\n  // Validate environment variables when options are first requested\n  validateEnvVars();\n  \n  const GoogleProvider = await getGoogleProvider();\n  const CredentialsProvider = await getCredentialsProvider();\n  \n  // Note: Adapter removed temporarily to fix __internal error\n  // JWT strategy works without adapter - adapter is only needed for database sessions\n  // We can add it back later once NextAuth v5 beta compatibility is resolved\n  \n  return {\n    // adapter: await getPrismaAdapter(), // Temporarily disabled\n    secret: process.env.NEXTAUTH_SECRET!,\n    trustHost: true,\n    basePath: '/api/auth',\n    providers: [\n      GoogleProvider({\n        clientId: process.env.GOOGLE_CLIENT_ID || '',\n        clientSecret: process.env.GOOGLE_CLIENT_SECRET || '',\n      }),\n      CredentialsProvider({\n        name: 'Credentials',\n        credentials: {\n          email: { label: 'Email', type: 'email' },\n          password: { label: 'Password', type: 'password' },\n        },\n        async authorize(credentials: any) {\n          if (!credentials?.email || !credentials?.password) {\n            return null;\n          }\n\n          // Normalize email: trim and lowercase to match database storage\n          const email = credentials.email.toString().trim().toLowerCase();\n          const password = credentials.password as string;\n\n          try {\n            // Import prisma directly - singleton pattern handles hot-reload\n            const { prisma } = await import('@/lib/prisma');\n            const user = await prisma.user.findUnique({\n              where: { email },\n            });\n\n            if (!user || !user.password) {\n              return null;\n            }\n\n            // Verify password\n            const bcrypt = await getBcrypt();\n            const isPasswordValid = await bcrypt.compare(password, user.password);\n\n            if (!isPasswordValid) {\n              return null;\n            }\n\n            return {\n              id: user.id,\n              email: user.email,\n              name: user.name,\n              image: user.image,\n            };\n          } catch (error) {\n            console.error('Auth error:', error);\n            return null;\n          }\n        },\n      }),\n    ],\n    session: {\n      strategy: 'jwt',\n    },\n    pages: {\n      signIn: '/auth/signin',\n    },\n    callbacks: {\n      async jwt({ token, user }: { token: any; user: any }) {\n        if (user) {\n          token.id = user.id;\n          token.email = user.email;\n          token.name = user.name;\n          token.picture = user.image;\n        }\n        return token;\n      },\n      async session({ session, token }: { session: any; token: any }) {\n        // Debug logging\n        console.log('Session callback - token:', { id: token.id, email: token.email, name: token.name });\n        console.log('Session callback - session before:', { hasUser: !!session.user, userKeys: session.user ? Object.keys(session.user) : [] });\n        \n        // Always ensure user object exists\n        if (!session.user) {\n          session.user = {};\n        }\n        \n        // Populate user object from token\n        if (token.id) {\n          session.user.id = token.id as string;\n        }\n        if (token.email) {\n          session.user.email = token.email;\n        }\n        if (token.name) {\n          session.user.name = token.name;\n        }\n        if (token.picture || token.image) {\n          session.user.image = token.picture || token.image;\n        }\n        \n        console.log('Session callback - session after:', { hasUser: !!session.user, userId: session.user.id, userKeys: Object.keys(session.user) });\n        return session;\n      },\n    },\n  };\n}\n\n// Note: authOptions is NOT exported to prevent module-level evaluation\n// All files should use the auth() function instead\n// If you absolutely need authOptions, use getAuthOptions() (internal only)\n\n// Initialize NextAuth - using lazy initialization to avoid module evaluation issues\nlet nextAuthInstance: any = null;\n\nasync function getNextAuth() {\n  if (!nextAuthInstance) {\n    try {\n      const NextAuth = await getNextAuthModule();\n      const authOptions = await getAuthOptions();\n      nextAuthInstance = NextAuth(authOptions);\n    } catch (error: any) {\n      console.error('‚ùå Failed to initialize NextAuth:', error);\n      if (error.message?.includes('environment variables')) {\n        console.error('\\nüìã Please check ENV_SETUP_GUIDE.md for setup instructions.');\n      }\n      throw error;\n    }\n  }\n  return nextAuthInstance;\n}\n\n// Export handlers with explicit parameter handling and error handling\nexport async function GET(\n  req: Request,\n  context: { params: Promise<{ nextauth?: string[] }> }\n) {\n  try {\n    const { handlers } = await getNextAuth();\n    return handlers.GET(req as any);\n  } catch (error: any) {\n    console.error('‚ùå Auth GET handler error:', error);\n    // Return a proper JSON error response instead of HTML\n    return new Response(\n      JSON.stringify({ \n        error: 'Authentication configuration error',\n        message: error.message || 'Please check your environment variables. See ENV_SETUP_GUIDE.md'\n      }),\n      {\n        status: 500,\n        headers: { 'Content-Type': 'application/json' },\n      }\n    );\n  }\n}\n\nexport async function POST(\n  req: Request,\n  context: { params: Promise<{ nextauth?: string[] }> }\n) {\n  try {\n    const { handlers } = await getNextAuth();\n    return handlers.POST(req as any);\n  } catch (error: any) {\n    console.error('‚ùå Auth POST handler error:', error);\n    // Return a proper JSON error response instead of HTML\n    return new Response(\n      JSON.stringify({ \n        error: 'Authentication configuration error',\n        message: error.message || 'Please check your environment variables. See ENV_SETUP_GUIDE.md'\n      }),\n      {\n        status: 500,\n        headers: { 'Content-Type': 'application/json' },\n      }\n    );\n  }\n}\n\n// Export auth utilities - all lazy to avoid module-level initialization\nexport async function auth(req?: Request | NextRequest | any) {\n  const nextAuth = await getNextAuth();\n  try {\n    if (req) {\n      // For NextRequest, we need to construct a proper Request with cookies\n      let request: Request;\n      \n      if (req instanceof Request) {\n        // It's already a Request\n        request = req;\n      } else {\n        // It's a NextRequest - get URL and headers properly\n        let url: string;\n        let headers: Headers;\n        \n        // For NextRequest, use url property directly (it's always available)\n        url = (req as any).url || (req as any).href || 'http://localhost:3000';\n        \n        // CRITICAL: Copy all headers including cookies from NextRequest\n        // NextRequest.headers is a Headers object, we need to copy it properly\n        if ((req as any).headers) {\n          headers = new Headers();\n          // Copy all headers from NextRequest to new Headers object\n          (req as any).headers.forEach((value: string, key: string) => {\n            headers.set(key, value);\n          });\n        } else {\n          headers = new Headers();\n        }\n        \n        request = new Request(url, {\n          method: (req as any).method || 'GET',\n          headers: headers,\n        });\n      }\n      \n      const result = await nextAuth.auth(request as any);\n      console.log('auth() result with request:', {\n        hasResult: !!result,\n        hasUser: !!result?.user,\n        userId: result?.user?.id,\n        resultKeys: result ? Object.keys(result) : [],\n        resultType: typeof result,\n        resultStringified: JSON.stringify(result),\n      });\n      \n      // NextAuth v5 beta might return { session } instead of session directly\n      if (result && typeof result === 'object' && 'session' in result) {\n        console.log('Found session in result.session:', result.session);\n        return result.session;\n      }\n      \n      return result;\n    }\n    // In API routes, auth() should automatically read from headers\n    const result = await nextAuth.auth();\n    console.log('auth() result without request:', {\n      hasResult: !!result,\n      hasUser: !!result?.user,\n      userId: result?.user?.id,\n      resultKeys: result ? Object.keys(result) : [],\n      resultType: typeof result,\n      resultStringified: JSON.stringify(result),\n    });\n    \n    // NextAuth v5 beta might return { session } instead of session directly\n    if (result && typeof result === 'object' && 'session' in result) {\n      console.log('Found session in result.session:', result.session);\n      return result.session;\n    }\n    \n    return result;\n  } catch (error: any) {\n    console.error('Error in auth() function:', error);\n    console.error('Error details:', {\n      message: error.message,\n      stack: error.stack?.split('\\n').slice(0, 5).join('\\n'),\n      reqType: req ? typeof req : 'undefined',\n      hasNextUrl: req && typeof req === 'object' ? 'nextUrl' in req : false,\n      nextUrlValue: req && typeof req === 'object' && 'nextUrl' in req ? (req as any).nextUrl : 'N/A',\n    });\n    return null;\n  }\n}\n\nexport async function signIn(...args: any[]) {\n  const nextAuth = await getNextAuth();\n  return nextAuth.signIn(...args as any);\n}\n\nexport async function signOut(...args: any[]) {\n  const nextAuth = await getNextAuth();\n  return nextAuth.signOut(...args as any);\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 394, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Documents/fDigit%20Technologies/NaijaPrepAI/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\n\nimport { PrismaClient } from '@prisma/client';\n\n// Extend the Global interface for TypeScript to recognize the global prisma property\ndeclare global {\n  // eslint-disable-next-line no-var\n  var cachedPrisma: PrismaClient;\n}\n\n// Lazy initialization function - only creates PrismaClient when called\n// This prevents module-level evaluation issues with Next.js 16 + Turbopack\nfunction getPrismaClient(): PrismaClient {\n  if (process.env.NODE_ENV === 'production') {\n    // In production, always create a new client\n    return new PrismaClient();\n  } else {\n    // In development, use the global object to keep a single instance\n    if (!global.cachedPrisma) {\n      // Create PrismaClient only when function is called (not at module load)\n      global.cachedPrisma = new PrismaClient();\n    }\n    return global.cachedPrisma;\n  }\n}\n\n// Export as a Proxy to make it truly lazy - only creates client when property is accessed\nexport const prisma = new Proxy({} as PrismaClient, {\n  get(_target, prop) {\n    const client = getPrismaClient();\n    const value = client[prop as keyof PrismaClient];\n    // If it's a function, bind it to the client instance\n    if (typeof value === 'function') {\n      return value.bind(client);\n    }\n    return value;\n  },\n});\n\nexport default prisma;\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;;;AAEhB;;AAQA,uEAAuE;AACvE,2EAA2E;AAC3E,SAAS;IACP;;SAGO;QACL,kEAAkE;QAClE,IAAI,CAAC,OAAO,YAAY,EAAE;YACxB,wEAAwE;YACxE,OAAO,YAAY,GAAG,IAAI,6IAAY;QACxC;QACA,OAAO,OAAO,YAAY;IAC5B;AACF;AAGO,MAAM,SAAS,IAAI,MAAM,CAAC,GAAmB;IAClD,KAAI,OAAO,EAAE,IAAI;QACf,MAAM,SAAS;QACf,MAAM,QAAQ,MAAM,CAAC,KAA2B;QAChD,qDAAqD;QACrD,IAAI,OAAO,UAAU,YAAY;YAC/B,OAAO,MAAM,IAAI,CAAC;QACpB;QACA,OAAO;IACT;AACF;uCAEe"}},
    {"offset": {"line": 553, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Documents/fDigit%20Technologies/NaijaPrepAI/services/geminiService.ts"],"sourcesContent":["import { GoogleGenAI, Type } from \"@google/genai\";\nimport { LessonContent, SelectionState, ExamQuestion } from \"../types\";\nimport { AggregatedContent } from \"./examPrepService\";\nimport { ClassLevel } from \"@prisma/client\";\n\nconst ai = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY || process.env.API_KEY });\n\nexport const generateLessonPlan = async (selection: SelectionState): Promise<LessonContent> => {\n  const modelId = \"gemini-2.5-flash\"; // Using Flash for speed and efficiency with large text generation\n\n  const prompt = `\n    Create a comprehensive Nigerian curriculum (NERDC) aligned lesson plan.\n    \n    Context:\n    - Class: ${selection.classLevel}\n    - Subject: ${selection.subject}\n    - Term: ${selection.term}\n    - Week: ${selection.week}\n    - Specific Topic: ${selection.topic}\n\n    Requirements:\n    1. **Lesson Notes**: Detailed, academic tone, approx 800-1000 words. Use Markdown for formatting (headers, bold, lists). Include definitions, formulas (if applicable), and examples relevant to the Nigerian context.\n    2. **Summary**: 3-5 concise bullet points for revision.\n    3. **Practice Questions**: 5 Multiple Choice Questions (MCQs) with 4 options (A-D) and one correct answer with explanation.\n    4. **Theory Question**: 1 structured theory question with a detailed model answer.\n\n    Format the response as a structured JSON object.\n  `;\n\n  try {\n    const response = await ai.models.generateContent({\n      model: modelId,\n      contents: prompt,\n      config: {\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: Type.OBJECT,\n          properties: {\n            topicTitle: { type: Type.STRING, description: \"The formal title of the lesson\" },\n            introduction: { type: Type.STRING, description: \"A brief introductory paragraph\" },\n            mainContent: { type: Type.STRING, description: \"Full lesson notes in Markdown format\" },\n            summaryPoints: {\n              type: Type.ARRAY,\n              items: { type: Type.STRING },\n              description: \"List of key takeaways\"\n            },\n            practiceQuestions: {\n              type: Type.ARRAY,\n              items: {\n                type: Type.OBJECT,\n                properties: {\n                  question: { type: Type.STRING },\n                  options: {\n                    type: Type.ARRAY,\n                    items: { type: Type.STRING },\n                    description: \"Array of 4 options\"\n                  },\n                  correctOptionIndex: { type: Type.INTEGER, description: \"0-3 index of correct option\" },\n                  explanation: { type: Type.STRING, description: \"Why this answer is correct\" }\n                },\n                required: [\"question\", \"options\", \"correctOptionIndex\", \"explanation\"]\n              },\n              description: \"5 MCQs\"\n            },\n            theoryQuestion: {\n              type: Type.OBJECT,\n              properties: {\n                question: { type: Type.STRING },\n                answer: { type: Type.STRING, description: \"Detailed model answer\" }\n              },\n              required: [\"question\", \"answer\"]\n            }\n          },\n          required: [\"topicTitle\", \"introduction\", \"mainContent\", \"summaryPoints\", \"practiceQuestions\", \"theoryQuestion\"]\n        }\n      }\n    });\n\n    if (response.text) {\n      return JSON.parse(response.text) as LessonContent;\n    }\n    throw new Error(\"No content generated\");\n  } catch (error) {\n    console.error(\"Gemini API Error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Generate comprehensive exam questions from aggregated lesson content\n */\nexport const generateExamQuestions = async (\n  subject: string,\n  classLevel: ClassLevel,\n  aggregatedContent: AggregatedContent,\n  questionCount: number = 50\n): Promise<ExamQuestion[]> => {\n  const modelId = \"gemini-2.5-flash\";\n\n  // Build content summary for prompt\n  const contentSummary = aggregatedContent.fullContent.length > 10000\n    ? aggregatedContent.fullContent.substring(0, 10000) + \"\\n\\n[Content truncated for length...]\"\n    : aggregatedContent.fullContent;\n\n  const prompt = `\nYou are an expert Nigerian curriculum (NERDC) exam question generator specializing in Computer-Based Test (CBT) format questions.\n\nContext:\n- Subject: ${subject}\n- Class Level: ${classLevel}\n- Total Lessons Analyzed: ${aggregatedContent.lessonCount}\n- Topics Covered: ${aggregatedContent.topics.join(\", \")}\n\nLesson Content Summary:\n${contentSummary}\n\nKey Summary Points:\n${aggregatedContent.summaryPoints.slice(0, 20).join(\"\\n- \")}\n\nRequirements:\n1. Generate ${questionCount} comprehensive CBT (Computer-Based Test) questions\n2. Questions MUST cover ALL topics from the provided lessons: ${aggregatedContent.topics.join(\", \")}\n3. Difficulty distribution:\n   - 30% easy questions (basic recall and understanding)\n   - 50% medium questions (application and analysis)\n   - 20% hard questions (synthesis and evaluation)\n4. Each question should:\n   - Test understanding, not just memorization\n   - Be relevant to Nigerian curriculum standards (NERDC)\n   - Have exactly 4 options (A, B, C, D)\n   - Include a detailed explanation of why the correct answer is right\n   - Reference which topic it covers\n   - Be appropriate for ${classLevel} level\n5. Ensure comprehensive coverage - every major topic should have at least one question\n6. Questions should prepare students for actual WAEC/BECE exams\n7. Avoid duplicate questions or questions too similar to each other\n8. Make questions practical and applicable to real-world scenarios where possible\n\nFormat the response as a JSON array of questions.\n`;\n\n  try {\n    const response = await ai.models.generateContent({\n      model: modelId,\n      contents: prompt,\n      config: {\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: Type.ARRAY,\n          items: {\n            type: Type.OBJECT,\n            properties: {\n              question: {\n                type: Type.STRING,\n                description: \"The question text\"\n              },\n              options: {\n                type: Type.ARRAY,\n                items: { type: Type.STRING },\n                description: \"Array of exactly 4 options (A, B, C, D)\"\n              },\n              correctOptionIndex: {\n                type: Type.INTEGER,\n                description: \"Index of correct option (0-3)\"\n              },\n              explanation: {\n                type: Type.STRING,\n                description: \"Detailed explanation of why this answer is correct\"\n              },\n              topicCovered: {\n                type: Type.STRING,\n                description: \"Which topic from the lessons this question covers\"\n              },\n              difficulty: {\n                type: Type.STRING,\n                enum: [\"easy\", \"medium\", \"hard\"],\n                description: \"Difficulty level of the question\"\n              }\n            },\n            required: [\"question\", \"options\", \"correctOptionIndex\", \"explanation\", \"topicCovered\", \"difficulty\"]\n          }\n        }\n      }\n    });\n\n    if (response.text) {\n      const questions = JSON.parse(response.text) as ExamQuestion[];\n      \n      // Validate questions\n      if (!Array.isArray(questions)) {\n        throw new Error(\"AI response is not an array\");\n      }\n\n      // Validate each question has 4 options\n      const invalidQuestions = questions.filter(\n        q => !q.options || q.options.length !== 4\n      );\n      \n      if (invalidQuestions.length > 0) {\n        console.warn(`Warning: ${invalidQuestions.length} questions have invalid option count`);\n      }\n\n      return questions;\n    }\n    throw new Error(\"No content generated\");\n  } catch (error) {\n    console.error(\"Gemini API Error (Exam Questions):\", error);\n    throw error;\n  }\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 801, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Documents/fDigit%20Technologies/NaijaPrepAI/services/examPrepService.ts"],"sourcesContent":["import { prisma } from '../lib/prisma';\r\nimport { ClassLevel as PrismaClassLevel } from '@prisma/client';\r\nimport { ExamQuestion, ClassLevel } from '../types';\r\nimport { generateExamQuestions } from './geminiService';\r\n\r\n/**\r\n * Convert TypeScript ClassLevel enum to Prisma ClassLevel enum\r\n */\r\nfunction mapClassLevelToPrisma(classLevel: ClassLevel): PrismaClassLevel {\r\n  const normalized = classLevel.replace(/\\s+/g, '').toUpperCase();\r\n  if (normalized === 'JSS1') return PrismaClassLevel.JSS1;\r\n  if (normalized === 'JSS2') return PrismaClassLevel.JSS2;\r\n  if (normalized === 'JSS3') return PrismaClassLevel.JSS3;\r\n  if (normalized === 'SSS1') return PrismaClassLevel.SSS1;\r\n  if (normalized === 'SSS2') return PrismaClassLevel.SSS2;\r\n  if (normalized === 'SSS3') return PrismaClassLevel.SSS3;\r\n  return PrismaClassLevel.SSS1;\r\n}\r\n\r\n/**\r\n * Get all lessons for a specific subject and user\r\n */\r\nexport async function getLessonsBySubject(\r\n  userId: string,\r\n  subject: string,\r\n  classLevel?: ClassLevel\r\n) {\r\n  try {\r\n    const prismaClassLevel = classLevel ? mapClassLevelToPrisma(classLevel) : undefined;\r\n    const lessons = await prisma.lesson.findMany({\r\n      where: {\r\n        userId,\r\n        subject,\r\n        ...(prismaClassLevel && { classLevel: prismaClassLevel }),\r\n      },\r\n      orderBy: {\r\n        createdAt: 'desc',\r\n      },\r\n    });\r\n    return lessons;\r\n  } catch (error) {\r\n    console.error('Error fetching lessons by subject:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Aggregate lesson content for AI processing\r\n */\r\nexport interface AggregatedContent {\r\n  topics: string[];\r\n  fullContent: string;\r\n  summaryPoints: string[];\r\n  lessonCount: number;\r\n}\r\n\r\nexport function aggregateLessonContent(lessons: any[]): AggregatedContent {\r\n  if (lessons.length === 0) {\r\n    return {\r\n      topics: [],\r\n      fullContent: '',\r\n      summaryPoints: [],\r\n      lessonCount: 0,\r\n    };\r\n  }\r\n\r\n  const topics: string[] = [];\r\n  const summaryPoints: string[] = [];\r\n  const contentParts: string[] = [];\r\n\r\n  lessons.forEach((lesson) => {\r\n    // Collect topics\r\n    if (lesson.topic && !topics.includes(lesson.topic)) {\r\n      topics.push(lesson.topic);\r\n    }\r\n    if (lesson.topicTitle && !topics.includes(lesson.topicTitle)) {\r\n      topics.push(lesson.topicTitle);\r\n    }\r\n\r\n    // Collect summary points\r\n    if (lesson.summaryPoints && Array.isArray(lesson.summaryPoints)) {\r\n      summaryPoints.push(...lesson.summaryPoints);\r\n    }\r\n\r\n    // Collect main content with topic header\r\n    if (lesson.mainContent) {\r\n      contentParts.push(\r\n        `\\n## Topic: ${lesson.topicTitle || lesson.topic}\\n\\n${lesson.mainContent}`\r\n      );\r\n    }\r\n  });\r\n\r\n  return {\r\n    topics: [...new Set(topics)], // Remove duplicates\r\n    fullContent: contentParts.join('\\n\\n'),\r\n    summaryPoints: [...new Set(summaryPoints)], // Remove duplicates\r\n    lessonCount: lessons.length,\r\n  };\r\n}\r\n\r\n/**\r\n * Generate exam questions using AI\r\n */\r\nexport async function generateExamPrep(\r\n  userId: string,\r\n  subject: string,\r\n  classLevel: ClassLevel,\r\n  examName?: string,\r\n  questionCount: number = 50\r\n) {\r\n  try {\r\n    // 1. Get all lessons for this subject\r\n    const lessons = await getLessonsBySubject(userId, subject, classLevel);\r\n\r\n    if (lessons.length === 0) {\r\n      throw new Error(\r\n        `No lessons found for subject \"${subject}\". Please create some lessons first.`\r\n      );\r\n    }\r\n\r\n    // 2. Aggregate lesson content\r\n    const aggregatedContent = aggregateLessonContent(lessons);\r\n\r\n    // 3. Generate questions using AI\r\n    const questions = await generateExamQuestions(\r\n      subject,\r\n      classLevel,\r\n      aggregatedContent,\r\n      questionCount\r\n    );\r\n\r\n    // 4. Extract topics covered from lessons\r\n    const topicsCovered = aggregatedContent.topics;\r\n\r\n    // 5. Save to database\r\n    const prismaClassLevel = mapClassLevelToPrisma(classLevel);\r\n    const examPrep = await prisma.examPrep.create({\r\n      data: {\r\n        userId,\r\n        subject,\r\n        classLevel: prismaClassLevel,\r\n        examName: examName || `${subject} Exam Prep`,\r\n        sourceLessonIds: lessons.map((l) => l.id),\r\n        questions: questions as any,\r\n        totalQuestions: questions.length,\r\n        topicsCovered,\r\n        isActive: true,\r\n      },\r\n    });\r\n\r\n    return examPrep;\r\n  } catch (error) {\r\n    console.error('Error generating exam prep:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get exam preps for a user\r\n */\r\nexport async function getExamPreps(\r\n  userId: string,\r\n  filters?: {\r\n    subject?: string;\r\n    classLevel?: PrismaClassLevel;\r\n    isActive?: boolean;\r\n  }\r\n) {\r\n  try {\r\n    const whereClause: any = {\r\n      userId,\r\n    };\r\n    \r\n    if (filters?.subject) {\r\n      whereClause.subject = filters.subject;\r\n    }\r\n    \r\n    if (filters?.classLevel) {\r\n      whereClause.classLevel = filters.classLevel;\r\n    }\r\n    \r\n    // Default to showing only active exams if not specified\r\n    if (filters?.isActive !== undefined) {\r\n      whereClause.isActive = filters.isActive;\r\n    } else {\r\n      // Default: show only active exams\r\n      whereClause.isActive = true;\r\n    }\r\n    \r\n    const examPreps = await prisma.examPrep.findMany({\r\n      where: whereClause,\r\n      orderBy: {\r\n        createdAt: 'desc',\r\n      },\r\n    });\r\n    \r\n    return examPreps;\r\n  } catch (error) {\r\n    console.error('Error fetching exam preps:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get a specific exam prep by ID\r\n */\r\nexport async function getExamPrepById(id: string, userId?: string) {\r\n  try {\r\n    const examPrep = await prisma.examPrep.findUnique({\r\n      where: { id },\r\n    });\r\n\r\n    // Verify ownership if userId provided\r\n    if (examPrep && userId && examPrep.userId !== userId) {\r\n      throw new Error('Unauthorized access to exam prep');\r\n    }\r\n\r\n    return examPrep;\r\n  } catch (error) {\r\n    console.error('Error fetching exam prep:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete an exam prep\r\n */\r\nexport async function deleteExamPrep(id: string, userId: string) {\r\n  try {\r\n    // Verify ownership\r\n    const examPrep = await prisma.examPrep.findUnique({\r\n      where: { id },\r\n    });\r\n\r\n    if (!examPrep) {\r\n      throw new Error('Exam prep not found');\r\n    }\r\n\r\n    if (examPrep.userId !== userId) {\r\n      throw new Error('Unauthorized: Cannot delete this exam prep');\r\n    }\r\n\r\n    await prisma.examPrep.delete({\r\n      where: { id },\r\n    });\r\n\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Error deleting exam prep:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Calculate exam results\r\n */\r\nexport interface ExamAttempt {\r\n  questionIndex: number;\r\n  selectedOption: number;\r\n}\r\n\r\nexport interface ExamResult {\r\n  score: number;\r\n  correctAnswers: number;\r\n  totalQuestions: number;\r\n  results: Array<{\r\n    questionIndex: number;\r\n    isCorrect: boolean;\r\n    selectedOption: number;\r\n    correctOption: number;\r\n    explanation: string;\r\n    question: string;\r\n  }>;\r\n}\r\n\r\nexport function calculateExamResults(\r\n  questions: ExamQuestion[],\r\n  answers: ExamAttempt[]\r\n): ExamResult {\r\n  let correctAnswers = 0;\r\n  const results: ExamResult['results'] = [];\r\n\r\n  questions.forEach((question, index) => {\r\n    const answer = answers.find((a) => a.questionIndex === index);\r\n    const selectedOption = answer?.selectedOption ?? -1;\r\n    const isCorrect = selectedOption === question.correctOptionIndex;\r\n\r\n    if (isCorrect) {\r\n      correctAnswers++;\r\n    }\r\n\r\n    results.push({\r\n      questionIndex: index,\r\n      isCorrect,\r\n      selectedOption,\r\n      correctOption: question.correctOptionIndex,\r\n      explanation: question.explanation,\r\n      question: question.question,\r\n    });\r\n  });\r\n\r\n  const score = questions.length > 0 ? (correctAnswers / questions.length) * 100 : 0;\r\n\r\n  return {\r\n    score: Math.round(score * 100) / 100, // Round to 2 decimal places\r\n    correctAnswers,\r\n    totalQuestions: questions.length,\r\n    results,\r\n  };\r\n}\r\n\r\n/**\r\n * Save an exam prep attempt\r\n */\r\nexport interface ExamPrepAttemptData {\r\n  userId: string;\r\n  examPrepId: string;\r\n  totalQuestions: number;\r\n  correctAnswers: number;\r\n  score: number; // Percentage\r\n  timeSpent?: number; // Seconds\r\n  answers: ExamAttempt[];\r\n}\r\n\r\nexport async function saveExamPrepAttempt(data: ExamPrepAttemptData) {\r\n  try {\r\n    const attempt = await prisma.examPrepAttempt.create({\r\n      data: {\r\n        userId: data.userId,\r\n        examPrepId: data.examPrepId,\r\n        totalQuestions: data.totalQuestions,\r\n        correctAnswers: data.correctAnswers,\r\n        score: data.score,\r\n        timeSpent: data.timeSpent,\r\n        answers: data.answers as any, // Store as JSON\r\n      },\r\n    });\r\n    return attempt;\r\n  } catch (error) {\r\n    console.error('Error saving exam prep attempt:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get the best attempt for an exam prep\r\n */\r\nexport async function getBestExamPrepAttempt(userId: string, examPrepId: string) {\r\n  try {\r\n    const attempt = await prisma.examPrepAttempt.findFirst({\r\n      where: {\r\n        userId,\r\n        examPrepId,\r\n      },\r\n      orderBy: {\r\n        score: 'desc', // Get highest score\r\n      },\r\n    });\r\n    return attempt;\r\n  } catch (error) {\r\n    console.error('Error fetching best exam prep attempt:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all attempts for an exam prep\r\n */\r\nexport async function getExamPrepAttempts(userId: string, examPrepId: string) {\r\n  try {\r\n    const attempts = await prisma.examPrepAttempt.findMany({\r\n      where: {\r\n        userId,\r\n        examPrepId,\r\n      },\r\n      orderBy: {\r\n        createdAt: 'desc',\r\n      },\r\n    });\r\n    return attempts;\r\n  } catch (error) {\r\n    console.error('Error fetching exam prep attempts:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get attempt statistics for an exam prep\r\n */\r\nexport async function getExamPrepAttemptStats(userId: string, examPrepId: string) {\r\n  try {\r\n    console.log(`[getExamPrepAttemptStats] Checking attempts for userId: ${userId}, examPrepId: ${examPrepId}`);\r\n    \r\n    const attempts = await prisma.examPrepAttempt.findMany({\r\n      where: {\r\n        userId,\r\n        examPrepId,\r\n      },\r\n      orderBy: {\r\n        createdAt: 'desc',\r\n      },\r\n    });\r\n\r\n    console.log(`[getExamPrepAttemptStats] Found ${attempts.length} attempts`);\r\n\r\n    if (attempts.length === 0) {\r\n      return {\r\n        attemptCount: 0,\r\n        bestAttempt: null,\r\n        lastAttempt: null,\r\n      };\r\n    }\r\n\r\n    const bestAttempt = attempts.reduce((best, current) => \r\n      current.score > best.score ? current : best\r\n    );\r\n\r\n    const stats = {\r\n      attemptCount: attempts.length,\r\n      bestAttempt: {\r\n        score: bestAttempt.score,\r\n        correctAnswers: bestAttempt.correctAnswers,\r\n        totalQuestions: bestAttempt.totalQuestions,\r\n        createdAt: bestAttempt.createdAt,\r\n      },\r\n      lastAttempt: {\r\n        score: attempts[0].score, // First one is most recent due to orderBy desc\r\n        correctAnswers: attempts[0].correctAnswers,\r\n        totalQuestions: attempts[0].totalQuestions,\r\n        createdAt: attempts[0].createdAt,\r\n      },\r\n    };\r\n    \r\n    console.log(`[getExamPrepAttemptStats] Returning stats:`, stats);\r\n    return stats;\r\n  } catch (error) {\r\n    console.error('Error fetching exam prep attempt stats:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1139, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Documents/fDigit%20Technologies/NaijaPrepAI/app/api/exam-prep/%5Bid%5D/attempt/route.ts"],"sourcesContent":["// üí• CRITICAL FIX: Forces Next.js to use the Node.js environment\r\nexport const runtime = 'nodejs';\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { auth } from '@/app/api/auth/[...nextauth]/route';\r\nimport { getExamPrepById, calculateExamResults, ExamAttempt, saveExamPrepAttempt } from '@/services/examPrepService';\r\nimport { ExamQuestion } from '@/types';\r\n\r\n/**\r\n * POST /api/exam-prep/[id]/attempt\r\n * Submit exam attempt and get results\r\n */\r\nexport async function POST(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const session = await auth();\r\n    if (!session?.user?.id) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const { id } = await params;\r\n    const body = await request.json();\r\n    const { answers, timeSpent } = body;\r\n\r\n    if (!answers || !Array.isArray(answers)) {\r\n      return NextResponse.json(\r\n        { error: 'Answers array is required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Get exam prep\r\n    const examPrep = await getExamPrepById(id, session.user.id);\r\n\r\n    if (!examPrep) {\r\n      return NextResponse.json(\r\n        { error: 'Exam prep not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Parse questions from JSON\r\n    const questions = examPrep.questions as ExamQuestion[];\r\n\r\n    if (!questions || questions.length === 0) {\r\n      return NextResponse.json(\r\n        { error: 'No questions found in exam prep' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Calculate results\r\n    const results = calculateExamResults(questions, answers as ExamAttempt[]);\r\n\r\n    // Save attempt to database\r\n    try {\r\n      console.log(`[Exam Attempt] Saving attempt for userId: ${session.user.id}, examPrepId: ${id}`);\r\n      const savedAttempt = await saveExamPrepAttempt({\r\n        userId: session.user.id,\r\n        examPrepId: id,\r\n        totalQuestions: results.totalQuestions,\r\n        correctAnswers: results.correctAnswers,\r\n        score: results.score,\r\n        timeSpent: timeSpent || undefined,\r\n        answers: answers as ExamAttempt[],\r\n      });\r\n      console.log(`[Exam Attempt] Successfully saved attempt:`, savedAttempt.id);\r\n    } catch (saveError) {\r\n      console.error('[Exam Attempt] Error saving exam attempt:', saveError);\r\n      // Continue even if save fails - still return results\r\n    }\r\n\r\n    return NextResponse.json({ results });\r\n  } catch (error: any) {\r\n    console.error('Error processing exam attempt:', error);\r\n    return NextResponse.json(\r\n      { error: error.message || 'Failed to process exam attempt' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"AAAA,iEAAiE;;;;;;;AAGjE;AACA;AACA;AAJO,MAAM,UAAU;;;;AAWhB,eAAe,KACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,2JAAI;QAC1B,IAAI,CAAC,SAAS,MAAM,IAAI;YACtB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,OAAO,EAAE,SAAS,EAAE,GAAG;QAE/B,IAAI,CAAC,WAAW,CAAC,MAAM,OAAO,CAAC,UAAU;YACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA4B,GACrC;gBAAE,QAAQ;YAAI;QAElB;QAEA,gBAAgB;QAChB,MAAM,WAAW,MAAM,IAAA,gJAAe,EAAC,IAAI,QAAQ,IAAI,CAAC,EAAE;QAE1D,IAAI,CAAC,UAAU;YACb,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsB,GAC/B;gBAAE,QAAQ;YAAI;QAElB;QAEA,4BAA4B;QAC5B,MAAM,YAAY,SAAS,SAAS;QAEpC,IAAI,CAAC,aAAa,UAAU,MAAM,KAAK,GAAG;YACxC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAkC,GAC3C;gBAAE,QAAQ;YAAI;QAElB;QAEA,oBAAoB;QACpB,MAAM,UAAU,IAAA,qJAAoB,EAAC,WAAW;QAEhD,2BAA2B;QAC3B,IAAI;YACF,QAAQ,GAAG,CAAC,CAAC,0CAA0C,EAAE,QAAQ,IAAI,CAAC,EAAE,CAAC,cAAc,EAAE,IAAI;YAC7F,MAAM,eAAe,MAAM,IAAA,oJAAmB,EAAC;gBAC7C,QAAQ,QAAQ,IAAI,CAAC,EAAE;gBACvB,YAAY;gBACZ,gBAAgB,QAAQ,cAAc;gBACtC,gBAAgB,QAAQ,cAAc;gBACtC,OAAO,QAAQ,KAAK;gBACpB,WAAW,aAAa;gBACxB,SAAS;YACX;YACA,QAAQ,GAAG,CAAC,CAAC,0CAA0C,CAAC,EAAE,aAAa,EAAE;QAC3E,EAAE,OAAO,WAAW;YAClB,QAAQ,KAAK,CAAC,6CAA6C;QAC3D,qDAAqD;QACvD;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAQ;IACrC,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,MAAM,OAAO,IAAI;QAAiC,GAC3D;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}